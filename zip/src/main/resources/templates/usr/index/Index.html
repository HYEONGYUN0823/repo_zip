<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{usr/include/head :: head}"></head>
<!-- <title>메인 페이지 - A7A7 이걸 어떻게 해야할지</title> -->

<body>
    <!-- validation.js 및 테마 JS는 head 또는 body 하단에 위치 권장 -->
    <!-- <script src="/user/template/user_ui/assets/js/vendors/validation.js"></script> -->
    <!-- <script src="/user/template/user_ui/assets/js/theme.min.js"></script> -->

    <!-- Location Modal -->
	<div class="modal fade" id="locationSecondModal" tabindex="-1" aria-labelledby="locationSecondModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-body">
			<div class="mb-5 d-flex align-items-center justify-content-between">
				<h1 class="modal-title fs-5" id="locationSecondModalLabel">Add Your Location</h1>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="w-100"><form action="#"><div class="input-group">
				<input type="text" aria-label="Last name" class="form-control w-45" placeholder="Search for area, location more.." />
				<button class="input-group-text bg-transparent" type="submit">
					<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
				</button>
			</div></form></div>
			<div class="my-10 text-center"><img src="/user/template/user_ui/assets/images/svg-graphics/delivery-boy.svg" alt="" class="img-fluid" /></div>
		</div></div></div>
	</div>

	<!-- Register Modal -->
	<div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered"><div class="modal-content bg-light">
			<div class="modal-header bg-white">
				<h1 class="modal-title fs-5" id="exampleModalLabel">Register via Phone Number</h1>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body"><div class="row justify-content-center"><div class="col-lg-8 col-12"><div class="py-6">
				<h4 class="fs-6 mb-4">Enter your phone number to Signup or Register</h4>
				<form><div class="input-phone mb-2">
					<input type="tel" maxlength="10" class="form-control" pattern="[0-9]{3}-[0-9]{2}-[0-9]{3}" required />
				</div><div class="d-grid"><button type="submit" class="btn btn-primary">Next</button></div></form>
				<div class="mt-4"><small><a href="#">Terms of Service</a><a href="#" class="ms-3">Privacy Policy</a></small></div>
			</div></div></div></div>
		</div></div>
	</div>

    <!-- 오프캔버스 장바구니 -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
        <div class="offcanvas-header border-bottom">
            <div class="text-start"><h5 id="offcanvasRightLabel" class="mb-0 fs-4">장바구니</h5></div>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div>
                <ul class="list-group list-group-flush" id="offcanvasCartItemsContainer"><li class="list-group-item text-center text-muted small py-4">로딩 중...</li></ul>
                <div class="d-flex justify-content-between fw-bold mt-4" id="offcanvasSubtotalSection" style="display: none;">
                    <span>소계:</span><span id="offcanvasSubtotalValue">0원</span>
                </div>
                <div class="d-grid mt-4">
                    <a href="/usr/cart/CartUsrList" class="btn btn-primary mb-2">장바구니 보기</a>
                    <a th:if="${cartItemCount != null and cartItemCount > 0}" href="/usr/checkout/CheckoutUsrList" class="btn btn-dark" id="offcanvasCheckoutBtnLink">결제하기</a>
                    <a th:unless="${cartItemCount != null and cartItemCount > 0}" href="javascript:void(0);" class="btn btn-dark disabled" id="offcanvasCheckoutBtnLinkDisabled" style="display:none;">결제하기</a>
                </div>
            </div>
        </div>
    </div>

    <!-- 공통 알림/확인 모달 -->
    <div class="modal fade" id="commonActionModal" tabindex="-1" aria-labelledby="commonActionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="commonActionModalLabel">알림</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="commonActionModalMessage"></div>
                <div class="modal-footer" id="commonActionModalFooter"></div>
            </div>
        </div>
    </div>

	<main>
		<!-- section (메인 배너) -->
		<section class="py-lg-16 py-10"
			style="background: url(/user/template/user_ui/assets/images/banner/banner-4.jpg) no-repeat; background-position: center; background-size: cover">
		</section>

		<!-- section category (주석 처리) -->
		<!-- <section class="my-lg-14 my-8"> ... </section> -->

		<!-- 인기 밀키트 섹션 -->
		<section class="my-lg-14 my-8">
			<div class="container">
				<div class="row align-items-center mb-8">
					<div class="col-md-8 col-12">
						<div class="d-flex align-items-center">
							<div class="mt-1"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trending-up text-primary"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg></div>
							<div class="ms-3"><h3 class="mb-0 h4">인기 밀키트</h3><p class="mb-0">지금 가장 인기있는 밀키트를 만나보세요.</p></div>
						</div>
					</div>
					<div class="col-md-4 text-end d-none d-md-block"><a href="/usr/product/ProductUsrList" class="btn btn-primary">모든 밀키트 보기</a></div>
				</div>
				<div class="row g-4 row-cols-xl-4 row-cols-lg-3 row-cols-md-2 row-cols-sm-2 row-cols-1">
                    <div th:if="${popularProducts == null or #lists.isEmpty(popularProducts)}" class="col-12"><p class="text-center text-muted py-5">현재 인기있는 상품이 준비되지 않았습니다.</p></div>
					<th:block th:if="${popularProducts != null and not #lists.isEmpty(popularProducts)}">
                        <div class="col" th:each="product : ${popularProducts}" th:object="${product}">
                            <div class="card card-product h-100">
                                <div class="card-body d-flex flex-column">
                                    <div class="text-center position-relative">
                                        <a th:href="@{/usr/product/ProductUsrView(seq=*{seq})}">
                                            <img th:src="*{path ?: '/user/template/user_ui/assets/images/products/product-img-default.jpg'}" th:alt="*{mealKitName}" class="mb-3 img-fluid product-img-main" style="height: 180px; object-fit: contain;" />
                                        </a>
                                        <div class="card-product-action">
                                            <a href="javascript:void(0);" class="btn-action add-to-wishlist-main" th:attr="data-product-seq=*{seq}" data-bs-toggle="tooltip" data-bs-html="true" title="찜하기"><i class="bi bi-heart"></i></a>
                                        </div>
                                    </div>
                                    <div class="text-small mb-1 mt-auto">
                                        <a th:href="@{/usr/product/ProductUsrView(seq=*{seq})}" class="text-decoration-none text-muted" th:if="*{brandNameAsString != null and brandNameAsString != '브랜드 없음' and brandNameAsString != ''}" th:text="*{brandNameAsString}"><small>브랜드명</small></a>
                                    </div>
                                    <h2 class="fs-6 mb-0">
                                        <a th:href="@{/usr/product/ProductUsrView(seq=*{seq})}" class="text-inherit text-decoration-none product-title-clamp" th:title="*{mealKitName}" th:text="*{mealKitName}">상품명</a>
                                    </h2>
									<div class="mt-1 rating-text-group">
                                        <small class="text-warning render-stars-main" th:attr="data-rating=*{score != null ? score : 0.0}"></small>
                                        <span class="text-muted small ms-1">
                                            <!-- 평점 텍스트 -->
                                            <span th:text="*{score != null ? #numbers.formatDecimal(score, 1, 1, 'POINT') : '0.0'}">0.0</span>
                                            <!-- 구분자 -->
                                            <span th:if="*{reviewCount != null and reviewCount > 0}"></span>
                                            <!-- 리뷰 개수 (리뷰가 있을 때만 "리뷰 N건" 표시) -->
                                            <span th:if="*{reviewCount != null and reviewCount > 0}">
                                             (<span th:text="*{reviewCount}">0</span>)
                                            </span>
                                            <!-- 리뷰가 없을 경우 (선택적 메시지) -->
                                            <span th:if="*{reviewCount == null or reviewCount == 0} and *{score != null and score > 0.0}">
                                                (0)
                                            </span>
                                            <span th:if="*{reviewCount == null or reviewCount == 0} and (*{score == null or score == 0.0})">
                                                (0)
                                            </span>
                                        </span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mt-3">
                                        <div><span class="text-dark fw-bold" th:text="*{price != null ? #numbers.formatInteger(price, 0, 'COMMA') + '원' : '가격정보없음'}"></span></div>
                                        <div><button type="button" class="btn btn-primary btn-sm add-to-cart-main" th:attr="data-product-seq=*{seq}" th:disabled="*{stock == null or stock <= 0}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                            <th:block th:if="*{stock != null and stock > 0}">담기</th:block>
                                            <th:block th:if="*{stock == null or stock <= 0}">품절</th:block>
                                        </button></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </th:block>
				</div>
			</div>
		</section>

		<!-- "가장 인기 있는 레시피" 이하 기존 HTML 유지 -->
		<section class="my-lg-14 my-8"> <!-- 가장 인기 있는 레시피 -->
			<div class="container">
				<div class="row align-items-center mb-8">
					<div class="col-md-8 col-12">
						<div class="d-flex">
							<div class="mt-1"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-journal text-primary" viewBox="0 0 16 16"><path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z" /><path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z" /></svg></div>
							<div class="ms-3"><h3 class="mb-0">최근 올라온 레시피</h3><p class="mb-0">가장 인기 있는 요리법을 확인해 보세요.</p></div>
						</div>
					</div>
					<div class="col-md-4 text-end d-none d-md-block"><a href="../pages/blog-category.html" class="btn btn-primary">모든 레시피 보기</a></div>
				</div>
				<div class="row">
					<div class="col-12 col-md-6 col-lg-3 mb-8"><div class="mb-4"><a href="../pages/blog-category.html"><div class="img-zoom"><img src="/user/template/user_ui/assets/images/blog/blog-img-1.jpg" alt="" class="img-fluid rounded w-100" /></div></a></div><div><h4 class="h5"><a href="../pages/blog-category.html" class="text-inherit">바삭한 호박 스파게티</a></h4><div class="d-flex align-items-center lh-1"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-clock text-dark" viewBox="0 0 16 16"><path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z" /><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z" /></svg><small class="ms-1"><span class="text-dark fw-bold">15</span> 분전</small></div></div></div>
					<div class="col-12 col-md-6 col-lg-3 mb-8"><div class="mb-4"><a href="../pages/blog-category.html"><div class="img-zoom"><img src="/user/template/user_ui/assets/images/blog/blog-img-2.jpg" alt="" class="img-fluid rounded w-100" /></div></a></div><div><h4 class="h5"><a href="../pages/blog-category.html" class="text-inherit">아몬드 버터 초콜릿 칩 호박 바</a></h4><div class="d-flex align-items-center lh-1"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-clock text-dark" viewBox="0 0 16 16"><path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z" /><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z" /></svg><small class="ms-1"><span class="text-dark fw-bold">18</span> 분전</small></div></div></div>
					<div class="col-12 col-md-6 col-lg-3 mb-8"><div class="mb-4"><a href="../pages/blog-category.html"><div class="img-zoom"><img src="/user/template/user_ui/assets/images/blog/blog-img-3.jpg" alt="" class="img-fluid rounded w-100" /></div></a></div><div><h4 class="h5"><a href="../pages/blog-category.html" class="text-inherit">매콤한 새우 타코 마늘 고수 라임 슬로</a></h4><div class="d-flex align-items-center lh-1"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-clock text-dark" viewBox="0 0 16 16"><path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z" /><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z" /></svg><small class="ms-1"><span class="text-dark fw-bold">20</span> 분전</small></div></div></div>
					<div class="col-12 col-md-6 col-lg-3 mb-8"><div class="mb-4"><a href="../pages/blog-category.html"><div class="img-zoom"><img src="/user/template/user_ui/assets/images/blog/blog-img-4.jpg" alt="" class="img-fluid rounded w-100" /></div></a></div><div><h4 class="h5"><a href="../pages/blog-category.html" class="text-inherit">간단한 수제 토마토 수프</a></h4><div class="d-flex align-items-center lh-1"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-clock text-dark" viewBox="0 0 16 16"><path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z" /><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z" /></svg><small class="ms-1"><span class="text-dark fw-bold">9</span> 분전</small></div></div></div>
				</div>
			</div>
		</section>
		<section class="my-lg-14 my-8"> <!-- 25년 연속 등 --> <div class="container"><div class="row align-items-center"><div class="col-lg-4 col-md-6 col-12"><div class="mb-6 border-end-lg p-md-4 px-xl-12 text-center"><div><div class="mb-8"><svg xmlns="http://www.w3.org/2000/svg" width="34" height="34" fill="currentColor" class="bi bi-clock text-primary" viewBox="0 0 16 16"><path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z" /><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z" /></svg></div><h3 class="fs-5 mb-3">25년 연속 가장 저렴합니다</h3><p class="mb-0">주문하신 상품을 최대한 빨리 집 앞까지 배달받으세요.</p></div></div></div><div class="col-lg-4 col-md-6 col-12"><div class="mb-6 border-end-lg p-md-4 px-xl-12 text-center"><div><div class="mb-8"><svg xmlns="http://www.w3.org/2000/svg" width="34" height="34" fill="currentColor" class="bi bi-gift text-primary" viewBox="0 0 16 16"><path d="M3 2.5a2.5 2.5 0 0 1 5 0 2.5 2.5 0 0 1 5 0v.006c0 .07 0 .27-.038.494H15a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1v7.5a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 1 14.5V7a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h2.038A2.968 2.968 0 0 1 3 2.506V2.5zm1.068.5H7v-.5a1.5 1.5 0 1 0-3 0c0 .085.002.274.045.43a.522.522 0 0 0 .023.07zM9 3h2.932a.56.56 0 0 0 .023-.07c.043-.156.045-.345.045-.43a1.5 1.5 0 0 0-3 0V3zM1 4v2h6V4H1zm8 0v2h6V4H9zm5 3H9v8h4.5a.5.5 0 0 0 .5-.5V7zm-7 8V7H2v7.5a.5.5 0 0 0 .5.5H7z" /></svg></div><h3 class="fs-5 mb-3">최고의 가격 및 혜택</h3><p class="mb-0">지역 마트보다 저렴한 가격에, 그에 더해 훌륭한 캐시백 혜택도 제공됩니다.</p></div></div></div><div class="col-lg-4 col-md-6 col-12"><div class="mb-6 p-md-4 px-xl-12 text-center"><div><div class="mb-8"><svg xmlns="http://www.w3.org/2000/svg" width="34" height="34" fill="currentColor" class="bi bi-box-seam text-primary" viewBox="0 0 16 16"><path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2l-2.218-.887zm3.564 1.426L5.596 5 8 5.961 14.154 3.5l-2.404-.961zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923l6.5 2.6zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z" /></svg></div><h3 class="fs-5 mb-3">다양한 구색</h3><p class="mb-0">식품, 개인 관리, 가정용품 및 기타 카테고리에서 5000개 이상의 제품 중에서 선택하세요</p></div></div></div><div class="col-12 d-md-none d-lg-block"><hr class="mt-8 mb-10" /></div><div class="col-lg-4 col-md-6 col-12"><div class="mb-6 border-end-lg p-md-4 px-xl-12 text-center"><div><div class="mb-8"><svg xmlns="http://www.w3.org/2000/svg" width="34" height="34" fill="currentColor" class="bi bi-tablet text-primary" viewBox="0 0 16 16"><path d="M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h8zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4z" /><path d="M8 14a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" /></svg></div><h3 class="fs-5 mb-3">앱으로 쇼핑하세요</h3><p class="mb-0"><a href="#">태블릿 및 모바일용</a> 앱으로 이동 중에 쇼핑하세요 . 실시간 주문 추적을 받으세요. 최신 기능 업데이트를 받으세요</p></div></div></div><div class="col-lg-4 col-md-6 col-12"><div class="mb-6 border-end-lg p-md-4 px-xl-12 text-center"><div><div class="mb-8"><svg xmlns="http://www.w3.org/2000/svg" width="34" height="34" fill="currentColor" class="bi bi-truck text-primary" viewBox="0 0 16 16"><path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5v-7zm1.294 7.456A1.999 1.999 0 0 1 4.732 11h5.536a2.01 2.01 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456zM12 10a2 2 0 0 1 1.732 1h.768a.5.5 0 0 0 .5-.5V8.35a.5.5 0 0 0-.11-.312l-1.48-1.85A.5.5 0 0 0 13.02 6H12v4zm-9 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm9 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z" /></svg></div><h3 class="fs-5 mb-3">오늘 쇼핑을 하고 싶으신가요?</h3><p class="mb-0">수상 경력이 있는 <a href="#">특급 배송</a>이나 픽업 옵션 중에서 선택해보세요.</p></div></div></div><div class="col-lg-4 col-md-6 col-12"><div class="mb-6 p-md-4 px-xl-12 text-center"><div><div class="mb-8"><svg xmlns="http://www.w3.org/2000/svg" width="34" height="34" fill="currentColor" class="bi bi-arrow-repeat text-primary" viewBox="0 0 16 16"><path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z" /><path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z" /></svg></div><h3 class="fs-5 mb-3">반품/환불</h3><p class="mb-0">제품에 만족하지 못하셨나요? 문앞에서 반품하고 몇 시간 내에 환불받으세요.</p></div></div></div>
            </div></div>
		</section>
		<section class="py-lg-14 py-8 bg-light">
			<div class="container">
				<!-- ... (기존 Areas we deliver to 내용) ... -->
			</div>
		</section>
	</main>
	
	<script type="text/javascript" th:inline="javascript">
	/*<![CDATA[*/
    // 로그인 상태 및 URL 전역 변수 (컨트롤러에서 전달된 값 사용)
    const isLoggedIn = /*[[${session.sessSeqUsr != null}]]*/ false;
    const loginPageUrl = /*[[@{/usr/member/loginUsrForm}]]*/ '/usr/member/loginUsrForm'; // 실제 로그인 페이지 URL
    const cartPageUrl = /*[[@{/usr/cart/CartUsrList}]]*/ '/usr/cart/CartUsrList';   // 실제 장바구니 페이지 URL

	document.addEventListener('DOMContentLoaded', function() {
	    console.log("Index.html DOMContentLoaded - Script Start v7 (Login Aware Modal)");

	    const csrfTokenMeta = document.querySelector('meta[name="_csrf"]');
	    const csrfHeaderMeta = document.querySelector('meta[name="_csrf_header"]');
	    const csrfHeaders = { 'Content-Type': 'application/x-www-form-urlencoded' };
	    if (csrfTokenMeta && csrfHeaderMeta && csrfTokenMeta.content && csrfHeaderMeta.content) {
	        csrfHeaders[csrfHeaderMeta.content] = csrfTokenMeta.content;
	    } else { console.warn("CSRF meta tags not found for Index page."); }

        // --- 공통 모달 제어 로직 ---
        const commonModalElement = document.getElementById('commonActionModal');
        let commonModalInstance = null;
        if (commonModalElement) {
            commonModalInstance = new bootstrap.Modal(commonModalElement);
        } else {
            console.error("공통 모달 HTML 요소(ID: commonActionModal)를 Index 페이지에서 찾을 수 없습니다.");
        }
        const commonModalLabel = document.getElementById('commonActionModalLabel');
        const commonModalBody = document.getElementById('commonActionModalMessage');
        const commonModalFooter = document.getElementById('commonActionModalFooter');

        function showActionModal(title, message, buttons = []) {
            if (!commonModalInstance || !commonModalLabel || !commonModalBody || !commonModalFooter) {
                console.warn("Index: 모달 구성 요소 누락, 기본 alert/confirm으로 대체합니다.");
                let confirmResult = true;
                const confirmButtonConfig = buttons.find(b => b.isConfirm === true || b.text === '확인' || b.text === '예' || b.text === '삭제' || b.text === '장바구니로 이동' || b.text === '로그인으로 이동');
                const cancelButtonConfig = buttons.find(b => b.isCancel === true || b.text === '취소' || b.text === '아니요' || b.text === '계속 쇼핑하기');

                if (confirmButtonConfig && cancelButtonConfig) {
                    confirmResult = confirm(message);
                    if (confirmResult && typeof confirmButtonConfig.action === 'function') { confirmButtonConfig.action(); }
                    else if (!confirmResult && typeof cancelButtonConfig.action === 'function') { cancelButtonConfig.action(); }
                } else {
                    alert(message);
                    if (confirmButtonConfig && typeof confirmButtonConfig.action === 'function') { confirmButtonConfig.action(); }
                    else if (buttons.length > 0 && typeof buttons[0].action === 'function') { buttons[0].action(); }
                }
                return;
            }
            commonModalLabel.innerText = title;
            commonModalBody.innerHTML = message; // Allow HTML in message
            commonModalFooter.innerHTML = '';
            if (buttons.length === 0) {
                const btn = document.createElement('button'); btn.type = 'button'; btn.className = 'btn btn-secondary'; btn.dataset.bsDismiss = 'modal'; btn.innerText = '닫기'; commonModalFooter.appendChild(btn);
            } else {
                buttons.forEach(btnConfig => {
                    const button = document.createElement('button'); button.type = 'button'; button.className = `btn ${btnConfig.class || 'btn-light'}`; button.innerText = btnConfig.text;
                    if (btnConfig.dismissModal === true) { button.setAttribute('data-bs-dismiss', 'modal'); }
                    button.addEventListener('click', () => {
                        if (typeof btnConfig.action === 'function') { btnConfig.action(); }
                        if (btnConfig.dismissModal !== false && commonModalInstance) { commonModalInstance.hide(); }
                    });
                    commonModalFooter.appendChild(button);
                });
            }
            commonModalInstance.show();
        }

	    document.querySelectorAll('.add-to-cart-main').forEach(button => {
	        button.addEventListener('click', function() {
	            if (this.disabled) {
                    showActionModal("알림", "품절된 상품입니다.", [{text: '확인', class: 'btn-primary', dismissModal: true}]);
                    return;
                }
	            const productSeq = this.dataset.productSeq;
	            const quantity = 1;

                if (!isLoggedIn) { // ★★★ 로그인 상태 확인 ★★★
                    showActionModal(
                        "로그인 필요",
                        "로그인이 필요한 서비스입니다.<br/>로그인 페이지로 이동하시겠습니까?",
                        [
                            { text: '취소', class: 'btn-secondary', dismissModal: true },
                            { text: '로그인으로 이동', class: 'btn-primary', action: () => {
                                window.location.href = loginPageUrl + '?redirectURL=' + encodeURIComponent(window.location.pathname + window.location.search);
                            }}
                        ]
                    );
                    return;
                }

	            fetch('/usr/cart/addItem', { method: 'POST', headers: csrfHeaders, body: new URLSearchParams({ 'productSeq': productSeq, 'quantity': quantity }) })
	            .then(response => { if (!response.ok) { return response.json().then(err => { throw new Error(err.message || `서버 오류: ${response.status}`); }); } return response.json(); })
	            .then(data => {
	                if (data.success) {
                        showActionModal(
                            "장바구니 추가 완료",
                            (data.message || '상품이 장바구니에 추가되었습니다.') + "<br/>장바구니로 이동하시겠습니까?",
                            [
                                { text: '계속 쇼핑하기', class: 'btn-secondary', dismissModal: true },
                                { text: '장바구니로 이동', class: 'btn-primary', action: () => { window.location.href = cartPageUrl; } }
                            ]
                        );
	                    if (typeof loadOffcanvasCart === 'function') loadOffcanvasCart();
                        if (typeof updateHeaderCartCount === 'function') updateHeaderCartCount(data.cartItemCount);
	                } else { showActionModal('장바구니 추가 실패', data.message || '알 수 없는 오류.', [{text: '확인', class: 'btn-primary', dismissModal: true}]); }
	            })
	            .catch(error => { console.error('메인 페이지 장바구니 추가 오류:', error); showActionModal('장바구니 추가 오류', '오류가 발생했습니다: ' + error.message, [{text: '확인', class: 'btn-primary', dismissModal: true}]); });
	        });
	    });

        function renderStarsOnMain(ratingVal, starContainer) {
            if (!starContainer) return;
            let starsHtml = '';
            const numRating = parseFloat(ratingVal) || 0;
            const fullStars = Math.floor(numRating);
            const halfStar = (numRating % 1) >= 0.5;
            let totalRenderedStars = 0;
            for (let i = 0; i < fullStars; i++) { starsHtml += '<i class="bi bi-star-fill"></i>'; totalRenderedStars++; }
            if (halfStar && fullStars < 5 && totalRenderedStars < 5) { starsHtml += '<i class="bi bi-star-half"></i>'; totalRenderedStars++; }
            const emptyStars = 5 - totalRenderedStars;
            for (let i = 0; i < emptyStars; i++) { starsHtml += '<i class="bi bi-star"></i>'; }
            starContainer.innerHTML = starsHtml;
        }
        document.querySelectorAll('.render-stars-main').forEach(el => {
            const rating = el.getAttribute('data-rating');
            renderStarsOnMain(rating, el);
        });

        // --- 오프캔버스 관련 로직 ---
        const offcanvasElement = document.getElementById('offcanvasRight');
	    const offcanvasItemsContainer = document.getElementById('offcanvasCartItemsContainer');
	    const offcanvasSubtotalSection = document.getElementById('offcanvasSubtotalSection');
	    const offcanvasSubtotalValue = document.getElementById('offcanvasSubtotalValue');
        const offcanvasCheckoutBtnLink = document.getElementById('offcanvasCheckoutBtnLink');
        const offcanvasCheckoutBtnLinkDisabled = document.getElementById('offcanvasCheckoutBtnLinkDisabled');

	    async function loadOffcanvasCart() {
            if (!offcanvasItemsContainer || !offcanvasSubtotalSection || !offcanvasSubtotalValue ) {
                console.warn("오프캔버스 관련 HTML 요소가 Index 페이지에 일부 없습니다.");
                updateHeaderCartCountOnly(); return;
            }
            try {
	            const response = await fetch('/usr/cart/getCartSummary'); // CartController의 API 호출
	            if (!response.ok) {
                    offcanvasItemsContainer.innerHTML = '<li class="list-group-item text-muted small">장바구니를 불러오지 못했습니다.</li>';
                    console.error("오프캔버스 getCartSummary 실패, 상태: " + response.status);
                    return;
                }
	            const data = await response.json();
	            offcanvasItemsContainer.innerHTML = ''; // 기존 아이템 비우기
	            if (data.cartItems && data.cartItems.length > 0) {
	                data.cartItems.forEach(item => {
	                    const li = document.createElement('li');
	                    li.className = 'list-group-item py-3 ps-0 border-top';
	                    li.setAttribute('data-product-seq-offcanvas', item.productSeq);
	                    // 오프캔버스 아이템 HTML 구조 (ProductUsrView.html의 것과 동일하게 또는 유사하게)
	                    li.innerHTML = `
	                        <div class="row align-items-center">
	                            <div class="col-3">
	                                <img src="${item.productImageUrl || '/user/template/user_ui/assets/images/products/product-img-default.jpg'}" alt="${item.productName}" class="img-fluid" />
	                            </div>
	                            <div class="col-6">
	                                <h6 class="mb-0 fs-sm"><a href="/usr/product/ProductUsrView?seq=${item.productSeq}" class="text-inherit">${item.productName}</a></h6>
	                                <small class="text-muted">${item.quantity} x ${item.price ? item.price.toLocaleString() : 0}원</small>
	                            </div>
	                            <div class="col-3 text-end">
	                                <button class="btn btn-ghost btn-icon btn-sm text-muted rounded-circle remove-from-offcanvas-cart-btn-idx" type="button" aria-label="Remove item">
	                                    <i class="bi bi-x-lg"></i>
	                                </button>
	                            </div>
	                        </div>`;
	                    offcanvasItemsContainer.appendChild(li);
	                });
	                offcanvasSubtotalSection.style.display = 'flex';
	                offcanvasSubtotalValue.innerText = (data.totalAmount || 0).toLocaleString() + '원';
                    if(offcanvasCheckoutBtnLink) offcanvasCheckoutBtnLink.style.display = (data.cartItemCount > 0 ? 'block' : 'none');
                    if(offcanvasCheckoutBtnLinkDisabled) offcanvasCheckoutBtnLinkDisabled.style.display = (data.cartItemCount > 0 ? 'none' : 'block');
	                bindOffcanvasRemoveButtons();
	            } else {
	                offcanvasItemsContainer.innerHTML = '<li class="list-group-item text-center text-muted small py-4">장바구니가 비어있습니다.</li>';
	                offcanvasSubtotalSection.style.display = 'none';
                    if(offcanvasCheckoutBtnLink) offcanvasCheckoutBtnLink.style.display = 'none';
                    if(offcanvasCheckoutBtnLinkDisabled) offcanvasCheckoutBtnLinkDisabled.style.display = 'block';
	            }
	            updateHeaderCartCount(data.cartItemCount || 0);
	        } catch (error) {
                if (offcanvasItemsContainer) { offcanvasItemsContainer.innerHTML = '<li class="list-group-item text-muted small">장바구니 로드 오류.</li>';}
                console.error('오프캔버스 로드 오류 (Index):', error);
	        }
        }
	    function bindOffcanvasRemoveButtons() {
            document.querySelectorAll('.remove-from-offcanvas-cart-btn-idx').forEach(button => {
	            const newButton = button.cloneNode(true);
	            const oldButton = button; // 기존 버튼 참조
                if (oldButton.parentNode) { // 부모가 있을 때만 교체
	                oldButton.parentNode.replaceChild(newButton, oldButton);
                } else {
                    console.warn("Cannot replace offcanvas remove button, parentNode is null.");
                }
	            newButton.addEventListener('click', function(e) {
	                e.preventDefault();
	                const listItem = this.closest('li[data-product-seq-offcanvas]');
                    if (!listItem) { console.error("Offcanvas: Cannot find parent LI for remove button"); return; }
	                const productSeq = listItem.dataset.productSeqOffcanvas;
                    showActionModal( // 공통 모달 사용
                        "상품 삭제 확인",
                        "이 상품을 장바구니에서 삭제하시겠습니까?",
                        [
                            {text: '취소', class: 'btn-secondary', dismissModal: true},
                            {text: '삭제', class: 'btn-danger', action: () => removeItemAndReloadOffcanvas(productSeq)}
                        ]
                    );
	            });
	        });
        }
	    async function removeItemAndReloadOffcanvas(productSeq) {
            try {
	            const response = await fetch('/usr/cart/removeItem', { method: 'POST', headers: csrfHeaders, body: new URLSearchParams({'productSeq': productSeq }) });
	            const data = await response.json();
	            if (data.success) {
                    loadOffcanvasCart(); // 오프캔버스 내용 다시 로드
                    // 메인 페이지이므로, CartUsrList 페이지 리로드는 필요 없음
                } else {
                    showActionModal('상품 삭제 실패', data.message || '알 수 없는 오류가 발생했습니다.');
                }
	        } catch (error) {
                console.error('오프캔버스 상품 삭제 중 오류:', error);
                showActionModal('상품 삭제 오류', '오류가 발생했습니다: ' + error.message);
            }
        }
	    if (offcanvasElement) {
	        offcanvasElement.addEventListener('show.bs.offcanvas', loadOffcanvasCart);
	    }
        function updateHeaderCartCount(count) {
            const cartCountElement = document.getElementById('headerCartItemCount'); // 실제 헤더의 카운트 요소 ID
            if (cartCountElement) {
                cartCountElement.innerText = count > 0 ? String(count) : '';
                cartCountElement.style.display = count > 0 ? 'inline-block' : 'none';
            }
        }
        async function updateHeaderCartCountOnly() { // 오프캔버스 요소가 없을 때 헤더 카운트만 업데이트
            try {
                const response = await fetch('/usr/cart/getCartSummary');
                if (response.ok) {
                    const data = await response.json();
                    updateHeaderCartCount(data.cartItemCount || 0);
                } else {
                    console.warn("초기 헤더 카운트 업데이트를 위한 getCartSummary 호출 실패:", response.status);
                }
            } catch (error) {
                console.warn("초기 헤더 카운트 업데이트 중 오류:", error.message);
            }
        }

        if (offcanvasElement) { // 페이지 로드 시 오프캔버스 내용 및 헤더 카운트 초기 로드
            loadOffcanvasCart();
        } else { // 오프캔버스가 없으면 헤더 카운트만이라도 시도
            updateHeaderCartCountOnly();
        }

	    console.log("Index.html JavaScript execution finished. v7");
	});
	/*]]>*/
	</script>
		
	<div th:replace="~{usr/include/footer :: footer}"></div>

</body>
</html>