<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta content="Codescandy" name="author">
  <title>Sign in eCommerce HTML Template - FreshCart</title>
  <!-- Favicon icon-->
  <link rel="shortcut icon" type="image/x-icon" href="/user/template/user_ui/assets/images/favicon/favicon.ico">


  <!-- Libs CSS -->
  <link href="/user/template/user_ui/assets/libs/bootstrap-icons/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="/user/template/user_ui/assets/libs/feather-webfont/dist/feather-icons.css" rel="stylesheet">
  <link href="/user/template/user_ui/assets/libs/simplebar/dist/simplebar.min.css" rel="stylesheet">


  <!-- Theme CSS -->
  <link rel="stylesheet" href="/user/template/user_ui/assets/css/theme.min.css">
</head>

<body>
<script src="/assets/xdm/jquery/jquery-3.7.1.min.js"></script>

  <!-- navigation -->
  <div class="border-bottom shadow-sm">
    <nav class="navbar navbar-light py-2">
      <div class="container justify-content-center justify-content-lg-between">
        <a class="navbar-brand" href="/usr/index/Index">
          <img src="/user/template/user_ui/assets/images/logo/freshcart-logo.svg" alt="" class="d-inline-block align-text-top">
        </a>
        <span class="navbar-text">
          이미 계정을 가지고 있습니까? <a href="/usr/signin/signinUsr">로그인</a>
        </span>
      </div>
    </nav>
  </div>


  <main>
    <!-- section -->
    <section class="my-lg-14 my-8">
      <div class="container">
        <!-- row -->
        <div class="row justify-content-center align-items-center">
          <div class="col-12 col-md-6 col-lg-4 order-lg-1 order-2">
            <!-- img -->
            <img src="/user/template/user_ui/assets/images/svg-graphics/signin-g.svg" alt="" class="img-fluid" />
          </div>
          <!-- col -->
          <div class="col-12 col-md-6 offset-lg-1 col-lg-4 order-lg-2 order-1">
            <div class="mb-lg-9 mb-5">
              <h1 class="mb-1 h2 fw-bold">로그인</h1>
              <p>OOO에 다시 오신 것을 환영합니다! 시작하려면 아이디를 입력하세요.</p>
            </div>

            <form class="needs-validation" novalidate>
              <div class="row g-3">
                <!-- row -->

                <div class="col-12">
                  <!-- input -->
                  <label for="formSigninEmail" class="form-label visually-hidden">Email address</label>
                  <input type="text" class="form-control" id="iD" name="iD" placeholder="아이디를 입력해주세요" maxlength="16" required />
                  <div class="invalid-feedback">아이디를 정확히 입력해 주세요.</div>
                </div>
                <div class="col-12">
                  <!-- input -->
                  <div class="password-field position-relative">
                    <label for="formSigninPassword" class="form-label visually-hidden">Password</label>
                    <div class="password-field position-relative">
                      <input type="password" class="form-control fakePassword" id="passWord" name="passWord"
                        placeholder="비밀번호를 입력해주세요" maxlength="20" required />
                      <span><i class="bi bi-eye-slash passwordToggler"></i></span>
                      <div class="invalid-feedback">비밀번호를 정확히 입력해 주세요.</div>
                    </div>
                  </div>
                </div>
                <div class="d-flex justify-content-between">
                  <!-- form check -->
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" />
                    <!-- label -->
                    <label class="form-check-label" for="flexCheckDefault">로그인 상태 유지</label>
                  </div>
                  <div>
                    비밀번호를 잊어버리셨나요?
                    <a href="../pages/forgot-password.html">재설정</a>
                  </div>
                </div>
                <!-- btn -->
                <div class="col-12 d-grid"><button type="button" id="buttonSignIn" class="btn btn-primary">로그인</button></div>
                
                
				<!-- 모달 -->
				
				<div class="modal fade" id="modalAlert" tabindex="-1" role="dialog">
				    <div class="modal-dialog" role="document">
				        <div class="modal-content">
				            <div class="modal-header">
							  <h5 class="modal-title" id="modalAlertTitle">확 인</h5>
							  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>
				            <div class="modal-body" id="modalAlertBody"></div>
				            <div class="modal-footer">
				                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
				            </div>
				        </div>
				    </div>
				</div>
                
                <!-- link -->
                <div>
                  계정을 가지고 있지 않나요?
                  <a href="/usr/userUi/MemberUsrForm">회원가입</a>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>
  </main>


  <!-- <script src="../assets/libs/jquery/dist/jquery.min.js"></script> -->
  <script src="/user/template/user_ui/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/user/template/user_ui/assets/libs/simplebar/dist/simplebar.min.js"></script>

  <!-- Theme JS -->
  <script src="/user/template/user_ui/assets/js/theme.min.js"></script>

  <script src="/user/template/user_ui/assets/js/vendors/password.js"></script>
  <script src="/user/template/user_ui/assets/js/vendors/validation.js"></script>
  
	<script type="text/javascript">
	    document.getElementById("buttonSignIn").onclick = function(event) {
	        event.preventDefault(); // 기본 폼 제출 방지
	        loginLogic();
	    }
	
	    function validation() {
	        const idInput = document.getElementById("iD");
	        const passwordInput = document.getElementById("passWord");
	
	        const idValue = idInput.value.trim();
	        const passwordValue = passwordInput.value.trim();
	
	        const idPattern = /^[A-Za-z0-9]{4,16}$/;
	        const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]).{8,20}$/;
	
	        const idFeedback = document.getElementById("idFeedback");
	        const passwordFeedback = document.getElementById("passwordFeedback");
	
	        let isValid = true;
	
	        // 아이디 검사
	        if (idValue == "") {
	            idInput.classList.add("is-invalid");
	            idInput.classList.remove("is-valid");
	            idFeedback.textContent = "아이디를 입력해주세요.";
	            isValid = false;
	        } else if (!idPattern.test(idValue)) {
	            idInput.classList.add("is-invalid");
	            idInput.classList.remove("is-valid");
	            idFeedback.textContent = "아이디는 영어와 숫자를 조합하여 4~12자로 입력해주세요.";
	            isValid = false;
	        } else {
	            idInput.classList.remove("is-invalid");
	            idInput.classList.add("is-valid");
	        }
	
	        // 비밀번호 검사
	        if (passwordValue == "") {
	            passwordInput.classList.add("is-invalid");
	            passwordInput.classList.remove("is-valid");
	            passwordFeedback.textContent = "비밀번호를 입력해주세요.";
	            isValid = false;
	        } else if (!passwordPattern.test(passwordValue)) {
	            passwordInput.classList.add("is-invalid");
	            passwordInput.classList.remove("is-valid");
	            passwordFeedback.textContent = "비밀번호는 대문자, 소문자, 숫자, 특수문자를 포함하여 8~16자로 입력해주세요.";
	            isValid = false;
	        } else {
	            passwordInput.classList.remove("is-invalid");
	            passwordInput.classList.add("is-valid");
	        }
	
	        return isValid;
	    }
	
	    function loginLogic() {
	    	if(validation() == false) return false;
	
	        $.ajax({
	            async: true,
	            cache: false,
	            type: "post",
	            url: "/usr/signin/signinUsrProc",
	            data: {
	                "iD": $("#iD").val(),
	                "passWord": $("#passWord").val()
	            },
	            success: function(response) {
	                if (response.rt != "success") {
	                    document.getElementById("modalAlertTitle").innerText = "확 인";
	                    document.getElementById("modalAlertBody").innerText = "일치하는 회원이 존재 하지 않습니다!";
	                    $("#modalAlert").modal("show");
	                } else {
	                    location.href = "/usr/index/Index"; // 로그인 성공 후 이동할 경로
	                }
	            },
	            error: function(jqXHR, textStatus, errorThrown) {
	                console.error("AJAX 요청 실패:", textStatus, errorThrown);
	                alert("오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!오류발생!");
	            }
	        });
	    }
	</script>
	
	<script>
  // DOM이 완전히 로드된 후 실행
  document.addEventListener("DOMContentLoaded", function () {
    // 아이디와 비밀번호 input 요소
    const idInput = document.getElementById("iD");
    const passwordInput = document.getElementById("passWord");
    const loginButton = document.getElementById("buttonSignIn");

    // 엔터 키 입력 시 로그인 버튼 클릭
    function handleEnterKey(event) {
      if (event.key === "Enter") {
        event.preventDefault(); // 폼 전송 방지 (type="button"일 경우는 생략 가능하지만 안전하게 추가)
        loginButton.click();    // 로그인 버튼 클릭
      }
    }

    idInput.addEventListener("keydown", handleEnterKey);
    passwordInput.addEventListener("keydown", handleEnterKey);
  });
</script>
	
</body>

</html>